name: ci

on:
  push:
    branches: [ "master", "develop" ]

env:
  SONAR_ENABLED: false

jobs:
  sonarcloud:
    if: env.SONAR_ENABLED
    uses: ./.github/workflows/sonar-cloud-job.yml
    with:
      project: baccoapp-user-management
      organization: baccoapp
      solution_name: BaccoApp.UserManagement
    secrets: 
      token: ${{ secrets.SONAR_TOKEN }}

  build:
    uses: ./.github/workflows/build-push-gcr-job.yml
    needs: [sonarcloud]
    with:
      project: baccoapp-user-management
    secrets: 
      gcloud_service_key: ${{ secrets.GCLOUD_SERVICE_KEY }}
