name: ci

on:
  push:
    branches: [ "master", "develop" ]

jobs:
  sonarcloud:
    uses: ./.github/workflows/sonar-cloud-job.yml
    with:
      project: baccoapp-user-management
      organization: baccoapp
      solution_name: BaccoApp.UserManagement
    secrets: 
      token: ${{ secrets.SONAR_TOKEN }}

  build_api:
    uses: ./.github/workflows/build-push-gcr-job.yml
    needs: [sonarcloud]
    with:
      project: baccoapp-user-management-api
      tag: ${{ github.run_number }}
    secrets: 
      gcloud_service_key: ${{ secrets.GCLOUD_SERVICE_KEY }}
